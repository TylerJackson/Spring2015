#include <iostream>
#include <cstdlib>
#include <cstring>
#include <stdio.h>
#include <fstream>

using namespace std;
static int checkNum = rand() %100;
int authenticate();
void createRegAccount(char[]);
void createAdminAccount(); 

int main() {
	
	char dir[20];
	srand(0);
	char* temp;
	int isAdmin;
	isAdmin = 0;
	int canary;
	int nameLength = 20;
	char userName[20];
	char selection;
	
	
	

	canary = checkNum;


	temp = getenv("PWD");
	memset((void *)dir,0,20);
	
	
	cout<<"Welcome to the account creation tool!"<<endl;
	
	strcpy(dir,temp);
	cout<<"Your account file will be created at: "<<dir<<endl;

	cout<<"\nWould you like to authenticate as an admin? (y/n)"<<endl;
	cin.get(selection);

	if(selection == 'y')
		isAdmin = authenticate();
	if(!isAdmin)
		cout<<"Continuing as normal user."<<endl;

	cin.ignore(1000, '\n');
	cout<<"Enter your desired username, fewer than 20 characters (please):"<<endl;
	fgets(userName, nameLength, stdin);

	if(canary != checkNum)
	{
		cout<<"Too many characters! ABORT ABORT ABORT"<<endl;
	}
	else if(strlen(userName) > 18)
	{
		cout<<"Too many characters! ABORT ABORT ABORT"<<endl;
		exit(1);	
	}	
	else
	{
		
		if(isAdmin)
		{
			createAdminAccount();
		}
		else
		{
			createRegAccount(userName);
		}

	}

	return 0;
}

int authenticate() {

	cout<<"The admin challenge is to guess a random number between 0 and 1000."<<endl;
	cout<<"Guess: ";
	int guess = 0;
	cin>>guess;

	if(guess > 1000 || guess < 0)
	{
		cout<<"Admins can follow instructions"<<endl;
		return 0;
	}	

	if(guess == (rand() %1000) )
	{
		cout<<"Correct!"<<endl;
		return 1;
	}
	else
	{
		cout<<"Incorrect."<<endl;
		return 0;
	}

	return 0;
}

void createRegAccount(char userName[])
{
	

	ofstream accountWriter("account.dat");
	accountWriter<<"User name: "<<userName<<endl;
	cout<<"File created!"<<endl;
	accountWriter.flush();
	accountWriter.close();
	return;
}

void createAdminAccount()
{
	ofstream accountWriter("account.dat");
		cout<<"Admin account created!"<<endl;
		accountWriter<<"ADMIN ACCOUNT"<<endl;\
		accountWriter<<"User name:ADMIN"<<endl;
		cout<<"File created!"<<endl;
		accountWriter.flush();
		accountWriter.close();
		return;
}

